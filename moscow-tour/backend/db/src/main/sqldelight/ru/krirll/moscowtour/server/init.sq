-- Создание таблицы tours

CREATE TABLE tours (
  tour_id BIGSERIAL PRIMARY KEY,
  title VARCHAR(256) NOT NULL,
  description TEXT NOT NULL,
  city_id BIGINT NOT NULL,
  date_begin DATE NOT NULL,
  date_end DATE NOT NULL,
  actual_count INT DEFAULT NULL,
  count_trips INT NOT NULL,
  price NUMERIC(10,2) NOT NULL,
  FOREIGN KEY (city_id) REFERENCES cities (city_id)
    ON DELETE CASCADE
    ON UPDATE CASCADE
);

INSERT INTO tours (title, desctiption, city_id, date_begin, date_end, actual_count, count_trips, price) VALUES
('', '', 0, 0, 0, 0, 0, 0),
('', '', 0, 0, 0, 0, 0, 0);

-- Создание таблицы images

CREATE TABLE images (
  image_id BIGSERIAL PRIMARY KEY,
  path TEXT NOT NULL
);

INSERT INTO images (image_id, path) VALUES
(1, ''),
(1, '');

-- Создание таблицы tour_images

CREATE TABLE tour_images (
  tour_id BIGINT NOT NULL,
  image_id BIGINT NOT NULL,
  PRIMARY KEY (tour_id, image_id),
  FOREIGN KEY (tour_id) REFERENCES tours (tour_id)
    ON DELETE CASCADE
    ON UPDATE CASCADE,
  FOREIGN KEY (image_id) REFERENCES images (image_id)
    ON DELETE CASCADE
    ON UPDATE CASCADE
);

INSERT INTO tour_images (tour_id, image_id) VALUES
(0, 0),
(0, 0);

-- Создание таблицы cities

CREATE TABLE cities (
  city_id BIGSERIAL PRIMARY KEY,
  name VARCHAR(256) NOT NULL,
  country_id BIGINT NOT NULL,
  FOREIGN KEY (country_id) REFERENCES countries (country_id)
    ON DELETE CASCADE
    ON UPDATE CASCADE
);

INSERT INTO cities (name, country_id) VALUES
('Санкт-Петербург', 2),
('Владимир', 2),
('Лондон', 1),
('Ливерпуль', 1),
('Барселона', 6),
('Ливерпуль', 6),
('Нью-Йорк', 3),
('Шанхай', 4),
('Пекин', 4),
('Баку', 5);

-- Создание таблицы countries

CREATE TABLE countries (
  country_id BIGSERIAL PRIMARY KEY,
  name VARCHAR(256) NOT NULL
);

INSERT INTO countries (country_id, name) VALUES
(1, 'Англия'),
(2, 'Россия'),
(3, 'США'),
(4, 'Китай'),
(5, 'Азербайджан'),
(6, 'Испания');

-- Создание таблицы tickets

CREATE TABLE tickets (
  ticket_id BIGSERIAL PRIMARY KEY,
  tour_id BIGINT NOT NULL,
  account_id BIGINT NOT NULL,
  date DATE NOT NULL,
  external_path TEXT NOT NULL,
  FOREIGN KEY (tour_id) REFERENCES tours (tour_id)
    ON DELETE CASCADE
    ON UPDATE CASCADE,
  FOREIGN KEY (account_id) REFERENCES accounts (account_id)
    ON DELETE CASCADE
    ON UPDATE CASCADE
);

-- Создание таблицы accounts

CREATE TABLE accounts (
  account_id BIGSERIAL PRIMARY KEY,
  login VARCHAR(256) NOT NULL UNIQUE,
  password_hash TEXT NOT NULL
);

-- Создание таблицы saved_tours

CREATE TABLE saved_tours (
  saved_tour_id BIGSERIAL PRIMARY KEY,
  tour_id BIGINT NOT NULL,
  account_id BIGINT NOT NULL,
  UNIQUE (tour_id, account_id),
  FOREIGN KEY (tour_id) REFERENCES tours (tour_id)
    ON DELETE CASCADE
    ON UPDATE CASCADE,
  FOREIGN KEY (account_id) REFERENCES accounts (account_id)
    ON DELETE CASCADE
    ON UPDATE CASCADE
);

-- Создание таблицы search_info

CREATE TABLE search_info (
  search_id BIGSERIAL PRIMARY KEY,
  query VARCHAR(256) DEFAULT NULL,
  account_id BIGINT DEFAULT NULL,
  UNIQUE (query, account_id),
  FOREIGN KEY (account_id) REFERENCES accounts (account_id)
    ON DELETE CASCADE
    ON UPDATE CASCADE
);
